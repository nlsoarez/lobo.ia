# ==================================================================================
# LOBO IA V4.2 - CONFIGURAÇÕES OTIMIZADAS
# ==================================================================================
# Baseado em análise de logs e backtesting
# Última atualização: 2026-01-05
# ==================================================================================

# Configurações de Emergência OTIMIZADAS
emergency:
  enabled: true
  max_duration_hours: 6

  # OTIMIZADO: Multiplicadores ajustados para melhor balance risco/retorno
  trade_limit_multiplier: 1.75      # +75% trades durante emergência
  position_size_multiplier: 0.70    # -30% tamanho (mais conservador)
  filter_relaxation_percent: 35     # Reduzido de 40% para 35%

  # Limites de trades
  max_trades: 35
  max_positions_override: 7

  # OTIMIZADO: Sinais críticos com thresholds ajustados
  critical_signals:
    min_score: 68                   # ↑ Aumentado de 65 para 68 (melhor qualidade)
    max_rsi: 22                     # ↑ Aumentado de 20 para 22 (mais oportunidades)
    min_volume_ratio: 1.3           # ↓ Reduzido de 1.5 para 1.3 (permite mais cryptos)
    allowed_override_trades: 5
    max_market_cap_rank: 50         # NOVO: Filtra apenas top 50 criptos

  # OTIMIZADO: Triggers mais sensíveis
  triggers:
    hours_without_entry: 3          # Reduzido de 4 para 3
    consecutive_losses: 3
    daily_loss_threshold: -0.015    # Ajustado de -2% para -1.5%
    min_score_for_trigger: 60       # NOVO: Score mínimo para considerar trigger

  # Alertas
  alerts:
    enable_metric_alerts: true
    enable_opportunity_alerts: true
    notification_channels:
      - log
      - dashboard
    rsi_extreme_minutes: 25         # Reduzido de 30 para 25

# Limites Diários OTIMIZADOS
daily_limits:
  regular:
    max_trades: 20
    max_positions: 5
    max_daily_loss_percent: 2.0
    target_profit_percent: 5.0
    max_profit_percent: 8.0
    min_score_for_entry: 50         # NOVO: Score mínimo

  emergency:
    max_trades: 35
    max_positions: 7
    max_daily_loss_percent: 2.5     # Reduzido de 3% para 2.5%
    critical_trade_allowance: 5
    position_size_reduction: 0.30   # NOVO: Redução de posição em emergência

# Circuit Breakers OTIMIZADOS
circuit_breakers:
  enabled: true
  reset_condition: "win_or_4h"      # NOVO: Reset após win OU 4h sem trades

  levels:
    - losses: 2
      action: "reduce_30"           # OTIMIZADO: Reduzido de 50% para 30%
      multiplier: 0.7

    - losses: 3
      action: "pause_2min"          # OTIMIZADO: Reduzido de 5min para 2min
      pause_minutes: 2

    - losses: 4
      action: "reduce_and_pause"    # NOVO: Combina redução + pausa
      multiplier: 0.5
      pause_minutes: 10

    - losses: 5
      action: "stop_trading_1h"     # OTIMIZADO: Para por 1h (antes era indefinido)
      stop: true
      duration_hours: 1

# Parâmetros de Trading OTIMIZADOS
trading_params:
  # Sinais de entrada
  entry:
    min_score: 50
    max_rsi: 65
    min_volume_ratio: 0.8
    trend_alignment_required: false  # NOVO: Não exige alinhamento de tendência

  # Take Profit / Stop Loss OTIMIZADOS
  exit:
    take_profit_percent: 2.0        # 2%
    stop_loss_percent: 1.0          # 1%
    trailing_stop_activation: 1.0   # Ativa trailing em +1%
    trailing_stop_distance: 0.5     # 0.5% de distância

  # Timeout de posição
  timeout:
    max_hours: 2.0                  # 2h máximo (era 45min, muito agressivo)
    min_pnl_for_close: -0.5         # Fecha se PnL > -0.5%

# Health Metrics OTIMIZADOS
health_metrics:
  # Thresholds para status
  latency:
    green_ms: 50
    yellow_ms: 150                  # Reduzido de 200
    red_ms: 300

  success_rate:
    green_percent: 55               # Reduzido de 60 (mais realista)
    yellow_percent: 40
    red_percent: 25

  api_success:
    green_percent: 95
    yellow_percent: 85              # Aumentado de 80
    red_percent: 70

# Priorização de Sinais OTIMIZADA
signal_prioritization:
  weights:
    rsi_extreme: 35                 # ↑ Aumentado de 30
    score_high: 25
    volume_high: 18                 # ↓ Reduzido de 20
    trend_aligned: 12               # ↓ Reduzido de 15
    momentum_strong: 10

  # Limites de sinais
  max_critical_signals: 3
  max_high_signals: 5

  # Critérios para CRITICAL
  critical_criteria:
    min_rsi: 22                     # RSI <= 22 é oversold extremo
    min_score: 68
    min_volume: 1.3
    min_criteria_met: 2             # Precisa atender 2+ critérios

# Alertas OTIMIZADOS
alerts:
  # Inconsistência de métricas
  metric_inconsistency:
    enabled: true
    success_rate_threshold: 35      # Alerta se < 35% mas HEALTHY
    check_interval_minutes: 5

  # Oportunidades perdidas
  missed_opportunities:
    enabled: true
    min_score_to_track: 65          # Só rastreia score >= 65
    max_tracked: 50

  # RSI extremo
  rsi_extreme:
    enabled: true
    sustained_minutes: 25
    threshold_low: 22
    threshold_high: 78

  # Trade limits
  trade_limits:
    enabled: true
    warn_at_percent: 80             # Alerta em 80% do limite

# Performance Monitoring
performance:
  # Métricas para validação
  target_metrics:
    min_win_rate: 50.0
    max_drawdown: 3.0
    min_sharpe_ratio: 0.5
    max_consecutive_losses: 4

  # Rollback automático
  auto_rollback:
    enabled: true
    trigger_conditions:
      - consecutive_critical_losses: 3
      - daily_loss_percent: -3.5
      - win_rate_below: 30.0

# Logging
logging:
  # Log detalhado de decisões
  decision_logging:
    enabled: true
    include_signal_details: true
    include_reasons: true
    include_limitations: true

  # Retenção
  retention_days: 30
  max_decision_logs: 10000
